<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Parent Geenee Chat</title>

  <!-- 1) DF Messenger CSS & JS -->
  <link rel="stylesheet"
        href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css"/>
  <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

  <style>
    /* no display:none here! */
    df-messenger {
      position: fixed;
      bottom: 0;
      right: 0;
      z-index: 999;
      /* your other vars */
    }
  </style>

  <!-- 2) Grab & decode ?email= -->
  <script>
    function getQueryParam(n){ return new URLSearchParams(location.search).get(n) }
    let userEmail = getQueryParam("email");
    if(userEmail){
      try{ userEmail = decodeURIComponent(atob(userEmail)); }
      catch{ console.log("Not Base64, using as-is"); }
    }
    console.log("Email →", userEmail);
  </script>
</head>
<body>
  <!-- 3) Just the bare messenger -->
  <df-messenger
    id="chatbot"
    project-id="parent-geenee-dev-445110"
    agent-id="c6b2330d-fb94-4a93-9b2d-c5716ad2de36"
    language-code="en">
  </df-messenger>

  <!-- 4) Once the component is ready… -->
  <script>
    document.addEventListener("df-messenger-loaded", () => {
      const df = document.querySelector("df-messenger");
      // Log every outgoing request body
      df.addEventListener("df-request-sent", evt => {
        console.log("▶️ df-request-sent body:", evt.detail.body);
      });
      if (!df) return;

      // a) Inject your email
      if (userEmail) {
        df.setAttribute("user-id", userEmail);
        df.setAttribute("custom-data", JSON.stringify({ email: userEmail }));
      }

      // b) Auto-open
      const chat = df.shadowRoot.querySelector("df-messenger-chat");
      if (chat) chat.setAttribute("open", "");

      // c) Hide the little floating bubble icon
      const bubble = df.shadowRoot.querySelector("df-messenger-chat-bubble");
      if (bubble) bubble.style.display = "none";
    });
  </script>
</body>
</html>
