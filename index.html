<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Parent Geenee Chat</title>

  <!-- 1) DF Messenger CSS & JS -->
  <link rel="stylesheet"
        href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css"/>
  <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

  <style>
    /* Make sure it’s visible by default */
    df-messenger {
      position: fixed;
      bottom: 0;
      right: 0;
      z-index: 999;
    }
  </style>

  <!-- 2) Grab & decode ?email= -->
  <script>
    function getQueryParam(n){ return new URLSearchParams(location.search).get(n) }
    let userEmail = getQueryParam("email");
    if (userEmail) {
      try {
        userEmail = decodeURIComponent(atob(userEmail));
      } catch {
        console.log("Not Base64, using as-is");
      }
    }
    console.log("Email →", userEmail);
  </script>
</head>
<body>
  <!-- 3) Bare messenger -->
  <df-messenger
    id="chatbot"
    project-id="parent-geenee-dev-445110"
    agent-id="c6b2330d-fb94-4a93-9b2d-c5716ad2de36"
    language-code="en">
  </df-messenger>

  <!-- 4) Wire up logging & custom-data after load -->
  <script>
    window.addEventListener("df-messenger-loaded", () => {
      console.log("✅ df-messenger-loaded fired");

      const df = document.querySelector("df-messenger");
      if (!df) {
        console.error("❌ df-messenger element not found");
        return;
      }

      // A) Inject the email so it goes out on every request
      if (userEmail) {
        console.log("Setting custom-data=", { email: userEmail });
        df.setAttribute("custom-data", JSON.stringify({ email: userEmail }));
      }

      // B) Log every outgoing request
      df.addEventListener("df-request-sent", evt => {
        console.log("▶️ df-request-sent:", evt.detail.body);
      });

      // C) Log every incoming response
      df.addEventListener("df-response-received", evt => {
        console.log("◀️ df-response-received:", evt.detail.response);
      });
    });
  </script>
</body>
</html>
